{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["export default class Compress {\n    /**\n     * opts\n     *\n     * @param width   获取的图像大小\n     * @param type    指定图片格式\n     * @param quality 图片质量 0～1 ， 0.92 为默认值\n     */\n    constructor () {\n        this.opts = {\n            width: 300,\n            type: 'image/jpeg',\n            quality: 0.92,\n            success () {},\n            error (err) {\n                alert(err)\n            }\n        }\n    };\n\n    /**\n     * 图片压缩\n     * @param file\n     * @param option\n     */\n    image (file, option) {\n        if (typeof file !== 'object' || typeof file.name !== 'string') {\n            this.opts.error('请传入fileList对象');\n            return false\n        }\n\n        let ext = this.getFileExt(file.name);\n\n        if (ext !== 'jpg' && ext !== 'jpeg' && ext !== 'png') {\n            this.opts.error('只支持 jpg, png');\n            return false\n        }\n\n        this.opts = Object.assign(this.opts, option);\n        this.base64(this.getObjectURL(file), this.opts.success);\n    };\n\n    /**\n     * 图片转base64\n     * @param fileUrl\n     * @param fn\n     */\n    base64 (fileUrl, fn) {\n        let img = new Image();\n        img.src = fileUrl;\n\n        img.onload = () => {\n            let canvas = document.createElement('canvas');\n            let ctx    = canvas.getContext('2d');\n\n            let width = this.opts.width;\n            let height = width * img.height / img.width;\n\n            ctx.fillStyle = 'none';\n            canvas.width = width;\n            canvas.height = height;\n\n            ctx.drawImage(img, 0, 0, width, height);\n\n            fn(canvas.toDataURL(this.opts.type, this.opts.quality));\n        }\n    };\n\n    /**\n     * 获取file对象链接\n     * @param file\n     * @returns {*}\n     */\n    getObjectURL (file) {\n        var url = null;\n\n        if (window.URL) {\n            url = window.URL.createObjectURL(file);\n        } else if (window.webkitURL) {\n            url = window.webkitURL.createObjectURL(file);\n        } else {\n            file.select();\n            file.blur();\n            url = document.selection.createRange().text;\n        }\n        return url;\n    };\n\n    /**\n     * 获取文件拓展名\n     * @param str\n     * @returns {string}\n     */\n    getFileExt (str) {\n        return str.substr(str.lastIndexOf('.') + 1).toLowerCase();\n    };\n}"],"names":["Compress","opts","err","file","option","name","error","ext","getFileExt","Object","assign","base64","getObjectURL","success","fileUrl","fn","img","Image","src","onload","canvas","document","createElement","ctx","getContext","width","height","fillStyle","drawImage","toDataURL","type","quality","url","window","URL","createObjectURL","webkitURL","select","blur","selection","createRange","text","str","substr","lastIndexOf","toLowerCase"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAqBA;;;;;;;;wBAQF;;;aACNC,IAAL,GAAY;mBACD,GADC;kBAEF,YAFE;qBAGC,IAHD;mBAAA,qBAIG,EAJH;iBAAA,iBAKDC,GALC,EAKI;sBACFA,GAAN;;SANR;;;;;;;;;;;;8BAgBGC,MAAMC,QAAQ;gBACb,QAAOD,IAAP,yCAAOA,IAAP,OAAgB,QAAhB,IAA4B,OAAOA,KAAKE,IAAZ,KAAqB,QAArD,EAA+D;qBACtDJ,IAAL,CAAUK,KAAV,CAAgB,eAAhB;uBACO,KAAP;;;gBAGAC,MAAM,KAAKC,UAAL,CAAgBL,KAAKE,IAArB,CAAV;;gBAEIE,QAAQ,KAAR,IAAiBA,QAAQ,MAAzB,IAAmCA,QAAQ,KAA/C,EAAsD;qBAC7CN,IAAL,CAAUK,KAAV,CAAgB,cAAhB;uBACO,KAAP;;;iBAGCL,IAAL,GAAYQ,OAAOC,MAAP,CAAc,KAAKT,IAAnB,EAAyBG,MAAzB,CAAZ;iBACKO,MAAL,CAAY,KAAKC,YAAL,CAAkBT,IAAlB,CAAZ,EAAqC,KAAKF,IAAL,CAAUY,OAA/C;;;;;;;;;;;+BAQIC,SAASC,IAAI;;;gBACbC,MAAM,IAAIC,KAAJ,EAAV;gBACIC,GAAJ,GAAUJ,OAAV;;gBAEIK,MAAJ,GAAa,YAAM;oBACXC,SAASC,SAASC,aAAT,CAAuB,QAAvB,CAAb;oBACIC,MAASH,OAAOI,UAAP,CAAkB,IAAlB,CAAb;;oBAEIC,QAAQ,MAAKxB,IAAL,CAAUwB,KAAtB;oBACIC,SAASD,QAAQT,IAAIU,MAAZ,GAAqBV,IAAIS,KAAtC;;oBAEIE,SAAJ,GAAgB,MAAhB;uBACOF,KAAP,GAAeA,KAAf;uBACOC,MAAP,GAAgBA,MAAhB;;oBAEIE,SAAJ,CAAcZ,GAAd,EAAmB,CAAnB,EAAsB,CAAtB,EAAyBS,KAAzB,EAAgCC,MAAhC;;mBAEGN,OAAOS,SAAP,CAAiB,MAAK5B,IAAL,CAAU6B,IAA3B,EAAiC,MAAK7B,IAAL,CAAU8B,OAA3C,CAAH;aAbJ;;;;;;;;;;;qCAsBU5B,MAAM;gBACZ6B,MAAM,IAAV;;gBAEIC,OAAOC,GAAX,EAAgB;sBACND,OAAOC,GAAP,CAAWC,eAAX,CAA2BhC,IAA3B,CAAN;aADJ,MAEO,IAAI8B,OAAOG,SAAX,EAAsB;sBACnBH,OAAOG,SAAP,CAAiBD,eAAjB,CAAiChC,IAAjC,CAAN;aADG,MAEA;qBACEkC,MAAL;qBACKC,IAAL;sBACMjB,SAASkB,SAAT,CAAmBC,WAAnB,GAAiCC,IAAvC;;mBAEGT,GAAP;;;;;;;;;;;mCAQQU,KAAK;mBACNA,IAAIC,MAAJ,CAAWD,IAAIE,WAAJ,CAAgB,GAAhB,IAAuB,CAAlC,EAAqCC,WAArC,EAAP;;;;;;;;;;;;"}